!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="a8bcfea9-807d-4733-9d8c-b5679ec51efb",e._sentryDebugIdIdentifier="sentry-dbid-a8bcfea9-807d-4733-9d8c-b5679ec51efb")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"d9db2a99"};"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6151],{83991:function(e,r,t){t.d(r,{C:function(){return s},D:function(){return l}});var n=t(14489),o=t(10222);function i(){var e=(0,n._)(["\n  fragment CrosisContextCurrentUser on CurrentUser {\n    id\n    username\n    isSubscribed\n    roles {\n      id\n      name\n    }\n  }\n"]);return i=function(){return e},e}function a(){var e=(0,n._)(["\n  fragment CrosisContextRepl on Repl {\n    id\n    language\n    slug\n    user {\n      id\n      username\n    }\n    authorizations {\n      editFileContents {\n        isAuthorized\n      }\n    }\n  }\n"]);return a=function(){return e},e}var l=(0,o.Ps)(i()),s=(0,o.Ps)(a())},57017:function(e,r,t){t.d(r,{P2:function(){return s},he:function(){return l}});var n=t(84750),o=t(96583),i=t(6955),a=t(91620).Buffer;function l(e){var r=e.split(".");if(4!==r.length)throw Error("Invalid token: should have exactly 4 parts: "+e);for(var t=r[2].replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var n=window.atob(t);if(n.length<64)throw Error("Invalid token: signed part is too short: "+n.length);var o=n.substring(0,n.length-64);return i.api.token.ReplToken.decode(a.from(o,"base64"))}function s(e){var r,t=null!==(r=({"infra-staging":"platform-infra-staging",mark:"platform-replit"})[e])&&void 0!==r?r:"platform";return"https://zipper.".concat(e,".").concat(t,".replit.com")}(0,n._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return[4,fetch("http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/identity?audience=zipper",{headers:{"Metadata-Flavor":"Google"}})];case 1:return[4,e.sent().text()];case 2:return[2,e.sent()]}})})},32136:function(e,r,t){t.d(r,{Ci:function(){return i},cJ:function(){return a},hD:function(){return l}});var n=t(43605),o=/^(\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner|\.local)/;function i(e){return o.test(e)}function a(e){return e.startsWith(".")&&!n.ZP.includes(e)}var l=[".git",".upm",".cache","__pycache__","node_modules","venv",".pythonlibs",".local"]},24587:function(e,r,t){t.d(r,{qG:function(){return z},AJ:function(){return K},ZP:function(){return Q}});var n=t(84750),o=t(94213),i=t(32586),a=t(60770),l=t(82271),s=t(96583),c=t(25722),u=t(62764),f=t(74044),d=t(30348),h=t(70090),p=t(1425),v=t(80403),y=t(19031),m=t(6955),g=t(9679),C=t(58655),w=t(51603),E=t(18204),D=t(80012),b=t(57017),S=t(32136),k=t(4891),_=t(27362),F=t(90223),x=t(10104),T=t(19377),O=t(72100),R=t(86763),P=t.n(R),I=t(51228),N=t(99970),M=t(60498),J=t(32319),L=t(60245),A=t(6249),U=t(42190);function V(e,r){var t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var l=i.value;switch(l){case U.Df.NotFound:if(e.includes("no such file")||e.includes("file does not exist"))return U.Df.NotFound;break;case U.Df.AlreadyExists:if(e.includes("file exist"))return U.Df.AlreadyExists;break;case U.Df.NotDirectory:if(e.includes("not a directory"))return U.Df.NotDirectory;break;case U.Df.IsDirectory:if(e.includes("is a directory"))return U.Df.IsDirectory;break;case U.Df.InvalidPath:if(e.includes("absolute paths are not supported"))return U.Df.InvalidPath;break;case U.Df.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return U.Df.DiskQuotaExceeded;break;case U.Df.PermissionDenied:if(e.includes("permission denied"))return U.Df.PermissionDenied;break;case U.Df.FileSystemUnavailable:if(e.includes("input/output error"))return U.Df.FileSystemUnavailable;break;case U.Df.NotReadable:if(e.includes("could not read the uploaded file"))return U.Df.NotReadable;break;default:(0,A.Z)(l)}}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return null}var q=function(e){"use strict";(0,x._)(t,e);var r=(0,T._)(t);function t(e,a,l,c,u,f){(0,F._)(this,t),(E=r.call(this)).writeChanges=function(e,r){if(!E.channel&&!E.isReconnecting)throw Error("Trying to send changes before ever coming online");E.isReconnecting&&(E.didEditOffline=!0);var t=(0,L.ed)(e,E.localContent),n=t.op,i=t.docAfter;if(.1>Math.random()){var a=(0,L.f5)(I.type.apply(E.localContent,n)),l=e.apply((0,L.tT)(E.localContent));(a!==l.sliceString(0)||a!==(0,L.f5)(i))&&E.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:a,changeSetContent:l,docAfter:i})}var s=(null==r?void 0:r.author)==="ghostwriter"?{author:m.api.OTPacket.Author.GHOSTWRITER}:{};E.metadata=(0,o._)({},E.metadata,s);try{E.pending=I.type.compose(E.pending,n)}catch(e){throw J.Z.wrap(e).setExtras({op:n,pending:E.pending})}E.localContent=i,0!==E.pending.length?E.emit("fileDirty"):E.commitPromise&&E.emit("commitStart"),E.debounceSend()},E.updateCursors=function(e){E.pendingCursors=e,E.debounceSend()},E.isClean=function(){return E.committedVersion===E.version&&0===E.inflight.length&&0===E.pending.length},E.onError=function(e,r){if(r.originalError){var t="string"==typeof r.originalError?r.originalError:r.originalError.message,n=V(t,[U.Df.NotFound,U.Df.IsDirectory,U.Df.DiskQuotaExceeded,U.Df.InvalidPath,U.Df.PermissionDenied,U.Df.FileSystemUnavailable]);if(n){E.emit("fsError",n,t);return}}E.destroy();var a=Error("OT Error: "+e);E.emit("error",a,(0,i._)((0,o._)({},r),{filePath:E.linkedFile,version:E.version}))},E.sendOp=function(){if(E.channel&&"open"===E.channel.status&&!E.isReconnecting&&!(E.inflight.length>0)){if(0!==E.pending.length){var e=(0,L.gR)(E.pending);E.inflight=E.pending,E.pending=[],E.inflightOpsPromise=E.channel.request({ot:(0,o._)({spookyVersion:E.version,op:e},E.metadata)}),E.metadata={},E.inflightOpsPromise.then(function(r){r.error&&E.onError("error accepting packet",{originalError:r.error,op:e})})}if(0!==E.pendingCursors.length){var r=!0,t=!1,n=void 0;try{for(var i,a=E.flushedCursorIds[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=i.value;E.channel.send({otDeleteCursor:{id:l}})}}catch(e){t=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}E.flushedCursorIds=[];var s=!0,c=!1,u=void 0;try{for(var f,d=E.pendingCursors[Symbol.iterator]();!(s=(f=d.next()).done);s=!0){var h=f.value,p=Number(Math.random().toString().split(".")[1]).toString(36);E.flushedCursorIds.push(p),E.channel.send({otNewCursor:(0,o._)({id:p,user:E.user},h)})}}catch(e){c=!0,u=e}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}E.pendingCursors=[]}}},E.handlePacket=function(e,r){var t=e.op,n=e.version,o=e.crc32,i=e.userId,a=r.overrideReconnectingBuffer;if(E.isReconnecting&&!a){E.bufferedReconnectingOps.push({crc32:o,op:t,version:n,userId:i});return}if(-1===E.version){E.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});return}if(E.version++,n!==E.version){var l={originalError:null,expectedVersion:E.version,receivedVersion:n,incomingOp:t};E.logger.error("OT Error: invalid server version",(0,N.P1)({details:l})),E.onError("invalid server version",l);return}try{E.serverContent=I.type.apply(E.serverContent,t)}catch(e){E.onError("unable to apply updated content",{originalError:e,incomingOp:t});return}var s=h.str(E.serverContent)>>>0;if(s!==o){var c={originalError:null,incomingVersion:n,server:o,client:s,incomingOp:t};E.logger.error("OT Error: crc32 mismatch",(0,N.P1)({details:c})),E.onError("crc32 mismatch",c);return}if(E.uncommittedOps.push({version:n,crc32:o,op:t,userId:i}),E.dataloss&&E.shouldTrackDataLoss&&E.dataloss.storeOp({replId:E.replId,filePath:E.linkedFile.toString(),opType:"latestOp",op:{version:n,crc32:o},logger:E.logger,isReconnecting:E.isReconnecting}),JSON.stringify(t)===JSON.stringify(E.inflight)){E.dataloss&&E.shouldTrackDataLoss&&E.dataloss.storeOp({replId:E.replId,filePath:E.linkedFile.toString(),opType:"latestOwnOp",op:{version:n,crc32:o},logger:E.logger,isReconnecting:E.isReconnecting}),E.debounceCommit(),E.inflight=[],E.inflightOpsPromise=null,E.debounceSend(),E.debounceSend.flush();return}if(E.commitPromise||E.emit("fileDirty"),E.debounceCommit(),E.hasUncommittedMultiplayerOps=!0,E.inflight.length){var u=I.type.transform(E.inflight,t,"right");t=I.type.transform(t,E.inflight,"left"),E.inflight=u}if(E.pending.length){var f=I.type.transform(E.pending,t,"right");t=I.type.transform(t,E.pending,"left"),E.pending=f}var d=(0,L.mt)(t,E.localContent),p=d.changes,v=d.docAfter;if(.1>Math.random()){var y=(0,L.f5)(I.type.apply(E.localContent,t)),m=p.apply((0,L.tT)(E.localContent));(y!==m.sliceString(0)||y!==(0,L.f5)(v))&&E.onError("op to changeset mismatch",{originalError:null,op:t,otContent:y,changeSetContent:m,docAfter:v})}E.localContent=v,E.emit("changes",p,i)},E.handleNewCursor=function(e){E.emit("cursor",e)},E.handleDeleteCursor=function(e){var r=e.id;E.emit("removeCursor",r)};var d,p,y,g,C,E,D=(0,_._)(E);E.handleStatus=(d=(0,n._)(function(e){var r,t,n,o,i;return(0,s.Jh)(this,function(a){switch(a.label){case 0:if(!D.channel||"open"!==D.channel.status)return[2];if(e.linkedFile){if(null==e.contents)return D.onError("expected status contents, got null or undefined",{originalError:null}),[2];if(null==e.cursors)return D.onError("expected status cursors, got null or undefined",{originalError:null}),[2];if(null==e.version)return D.onError("expected status version, got null or undefined",{originalError:null}),[2];if(D.isReconnecting)return D.handleReconnect(e.contents,e.version),[2];return D.dataloss&&D.shouldTrackDataLoss&&D.dataloss.checkAndTrack({serverContent:e.contents,serverVersion:e.version,replId:D.replId,filePath:D.linkedFile.toString(),fetchOps:D.fetchOps,logger:D.logger}),D.serverContent=e.contents,D.localContent=D.serverContent,D.version=e.version,D.emit("firstConnect"),D.emit("changes",v.as.of({from:0,insert:D.serverContent},0)),e.cursors.forEach(D.handleNewCursor),D.emit("fileDirty"),D.debounceCommit(),[2]}return[4,D.channel.request({otLinkFile:{file:{path:D.linkedFile.toString()}}})];case 1:if((t=a.sent()).channelClosed)return[2];if(t.error)return D.onError("link file error "+t.error.replace(D.linkedFile.toString(),"$FILENAME"),{originalError:t.error}),[2];if(!t.otLinkFileResponse)return D.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null}),[2];if(n=t.otLinkFileResponse.version,i=w.Z.from(null!==(o=null===(r=t.otLinkFileResponse.linkedFile)||void 0===r?void 0:r.content)&&void 0!==o?o:"").toString(),D.isReconnecting)return D.handleReconnect(i,n),[2];return D.dataloss&&D.shouldTrackDataLoss&&D.dataloss.checkAndTrack({serverContent:i,serverVersion:n,replId:D.replId,filePath:D.linkedFile.toString(),fetchOps:D.fetchOps,logger:D.logger}),D.serverContent=i,D.localContent=D.serverContent,D.version=n,D.committedVersion=n,D.committedContent=D.serverContent,D.emit("firstConnect"),D.emit("changes",v.as.of({from:0,insert:D.serverContent},0)),[2]}})}),function(e){return d.apply(this,arguments)});var b=(0,_._)(E);E.handleReconnect=(p=(0,n._)(function(e,r){var t,n,a,l,c,u,f,d,h,p,v,y,m,g,C,w,E,D,S,k,_,F,x,T,O,R,P,J,L,A,U,V,q,B,z,Q,Z,K,W,H,j,$,Y,G,X,ee,er,et,en,eo,ei;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(!b.timeDisconnected)throw Error("wat");if(t=Date.now()-b.timeDisconnected,n={case:"other",remoteContent:e,localContent:b.localContent},a=function(n){b.reconnectTrackedData=(0,i._)((0,o._)({},n),{serverVersion:r,ourVersion:b.version,ourCommittedVersion:b.committedVersion,areContentsEqual:b.serverContent===e,areCommittedContentsEqual:b.committedContent===e,didReceiveOpsWhileReconnecting:!!b.bufferedReconnectingOps.length,didEditOffline:b.didEditOffline,hasPendingOps:!!b.pending.length,hasUncommittedMultiplayerOps:b.hasUncommittedMultiplayerOps,disconnectDuration:t});var a={};("has_inflight"===n.case||"same_version_different_content"===n.case||"multiplayer"===n.case)&&.1>Math.random()&&(a={hasAdditionalLogs:!0,localContent:String(b.localContent),ourContent:String(b.serverContent),ourCommittedContent:String(b.committedContent),ourInflight:JSON.stringify(b.inflight),ourPending:JSON.stringify(b.pending),serverContent:String(e)}),b.logger.info("OT Client: Reconnect",(0,N.P1)((0,o._)({},b.reconnectTrackedData,a))),b.track&&b.track(M.U3.FILE_RECONNECTED_STATUS2,b.reconnectTrackedData)},l=function(e,r){a({case:e,originCase:r,prompted:!1}),b.isReconnecting=!1,b.bufferedReconnectingOps=[],b.didEditOffline=!1,b.timeDisconnected=null,b.debounceSend(),b.debounceCommit(),b.emit("transparentReconnect",{case:e,originCase:r})},c=function(t){if(n.remoteContent===n.localContent){b.version=r,b.committedVersion=r,b.localContent=e,b.committedContent=e,b.serverContent=e,b.inflight=[],b.pending=[],l("unprompted_because_identical",t);return}a({case:t,prompted:!0}),n.case=t,b.emit("promptUserReconnect",n)},b.inflight.length){if(r===b.version&&b.serverContent===e)return b.pending=I.type.compose(b.inflight,b.pending),b.inflight=[],b.inflightOpsPromise=null,l("has_inflight_happy_path_ops_unreached"),[2];u=!1,f=b.serverContent;try{f=I.type.apply(f,b.inflight)}catch(e){u=!0}if(!u&&b.version+1===r&&f===e)return b.inflight=[],b.inflightOpsPromise=null,b.serverContent=e,b.version=r,l("has_inflight_happy_path_ops_reached"),[2];return c("has_inflight"),[2]}if(b.hasUncommittedMultiplayerOps)return c("multiplayer"),[2];if(b.version===r){if(e===b.serverContent)return l("happy_path"),[2];return c("same_version_different_content"),[2]}if(b.committedVersion===r){d=e;try{h=!0,p=!1,v=void 0;try{for(y=b.uncommittedOps[Symbol.iterator]();!(h=(m=y.next()).done);h=!0)g=m.value.op,d=I.type.apply(d,g)}catch(e){p=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw v}}}catch(e){return c("same_committed_version_unable_to_apply_ops"),[2]}if(d===b.serverContent){C=[],w=!0,E=!1,D=void 0;try{for(S=b.uncommittedOps[Symbol.iterator]();!(w=(k=S.next()).done);w=!0)_=k.value.op,C=I.type.compose(C,_)}catch(e){E=!0,D=e}finally{try{w||null==S.return||S.return()}finally{if(E)throw D}}return b.pending=I.type.compose(C,b.pending),b.uncommittedOps=[],b.version=r,b.serverContent=e,l("happy_path_uncommitted"),[2]}return c("same_committed_version_different_content_fixed"),[2]}if(!(b.version<r))return[3,3];return[4,b.fetchOps(b.version+1,r)];case 1:F=s.sent(),x=!1,T=b.serverContent;try{O=!0,R=!1,P=void 0;try{for(J=F[Symbol.iterator]();!(O=(L=J.next()).done);O=!0)A=L.value.op,T=I.type.apply(T,A)}catch(e){R=!0,P=e}finally{try{O||null==J.return||J.return()}finally{if(R)throw P}}}catch(e){x=!0}if(!x&&T===e){U=!0,V=!1,q=void 0;try{for(B=F[Symbol.iterator]();!(U=(z=B.next()).done);U=!0)Q=z.value,b.handlePacket(Q,{overrideReconnectingBuffer:!0})}catch(e){V=!0,q=e}finally{try{U||null==B.return||B.return()}finally{if(V)throw q}}Z=!0,K=!1,W=void 0;try{for(H=b.bufferedReconnectingOps[Symbol.iterator]();!(Z=(j=H.next()).done);Z=!0)$=j.value,b.handlePacket($,{overrideReconnectingBuffer:!0})}catch(e){K=!0,W=e}finally{try{Z||null==H.return||H.return()}finally{if(K)throw W}}return l("happy_path_server_ahead"),[2]}return[4,b.fetchOps(b.committedVersion+1,r)];case 2:Y=s.sent(),G=!1,X=b.committedContent;try{ee=!0,er=!1,et=void 0;try{for(en=Y[Symbol.iterator]();!(ee=(eo=en.next()).done);ee=!0)ei=eo.value.op,X=I.type.apply(X,ei)}catch(e){er=!0,et=e}finally{try{ee||null==en.return||en.return()}finally{if(er)throw et}}}catch(e){G=!0}if(!G&&X===e)return c("happy_path_uncommitted_server_ahead"),[2];return c("uncommitted_server_ahead"),[2];case 3:return c("other"),[2]}})}),function(e,r){return p.apply(this,arguments)});var S=(0,_._)(E);E.flush=(0,n._)(function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return[4,S.commitPromise];case 1:return e.sent(),S.debounceCommit(),S.debounceCommit.flush(),[4,S.commitPromise];case 2:return e.sent(),[2]}})}),E.isFileSaved=function(){return!0};var k=(0,_._)(E);E.fetchOps=(y=(0,n._)(function(e,r){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!k.channel)throw Error("No channel, cannot fetchOps");return[4,k.channel.request({otFetchRequest:{versionFrom:e,versionTo:r}})];case 1:if((t=n.sent()).channelClosed)throw Error("Channel closed while requesting");if(t.error)throw Error("Fetch ops returned an error: "+t.error);if(!t.otFetchResponse)throw Error("Expected otFetchResponse");if(!t.otFetchResponse.packets)throw Error("Expected otFetchResponse.packets");return[2,t.otFetchResponse.packets.map(function(e){var r=e.crc32,t=e.op,n=e.version,o=e.userId,i=e.committed,a=e.author;if(null==r)throw Error("Expected crc32 in packet");if(null==t)throw Error("Expected op in packet");if(null==n)throw Error("Expected version in packet");return{crc32:r,version:n,op:(0,L.ug)(t),userId:o,timestamp:i?1e3*i.seconds:0,author:a}})]}})}),function(e,r){return y.apply(this,arguments)});var x=(0,_._)(E);E.fetchChanges=(g=(0,n._)(function(e,r,t){var n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,x.fetchOps(e,r)];case 1:return n=i.sent(),o=t,[2,n.map(function(e){var r=e.op,t=e.version,n=e.userId,i=e.timestamp,a=e.crc32,l=(0,L.mt)(r,o),s=l.changes,c=l.docAfter,u=s.invert((0,L.tT)(o));return o=c,{changes:s,invertedChanges:u,userId:n,version:t,timestamp:i,crc32:a}})]}})}),function(e,r,t){return g.apply(this,arguments)});var T=(0,_._)(E);E.transformSelection=(C=(0,n._)(function(e){var r,t,n,o,i,a,l,c;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(r=e.indexStart,t=e.indexEnd,n=e.versionFrom,o=e.versionTo,!T.channel)throw Error("No channel, cannot transformSelection");return[4,T.channel.request({otTransformSelectionRequest:{indexStart:r,indexEnd:t,versionFrom:n,versionTo:o}})];case 1:if(!(i=s.sent()).otTransformSelectionResponse)throw Error("Expected otTransformSelectionResponse");return[2,{indexStart:null!==(a=i.otTransformSelectionResponse.indexStart)&&void 0!==a?a:0,indexEnd:null!==(l=i.otTransformSelectionResponse.indexEnd)&&void 0!==l?l:0,version:null!==(c=i.otTransformSelectionResponse.version)&&void 0!==c?c:0}]}})}),function(e){return C.apply(this,arguments)}),E.getLocalContent=function(){return(0,L.f5)(E.localContent)},E.getRawLocalContent=function(){return E.localContent},E.shouldTrackDataLoss=!1,E.replId="",E.linkedFile=e,E.channel=null,E.inflight=[],E.inflightOpsPromise=null,E.uncommittedOps=[],E.hasUncommittedMultiplayerOps=!1,E.committedVersion=-1,E.isReconnecting=!1,E.bufferedReconnectingOps=[],E.didEditOffline=!1,E.pending=[],E.metadata={},E.version=-1,E.serverContent="",E.localContent="",E.committedContent="",E.flushedCursorIds=[],E.pendingCursors=[],E.user=null,E.flushFailed=0,E.debounceSend=P()(function(){return E.sendOp()},20,{maxWait:60});var O=P()(function(){return E.commitToDisk()},1e3,{maxWait:3e3}),R=function(){if(!E.channel)throw Error("Tryna commit while offline");if(E.isReconnecting)throw Error("Committing while reconnecting");return O()};R.cancel=O.cancel,R.flush=O.flush,E.debounceCommit=R,E.commitPromise=null,E.timeDisconnected=null;var A=!1;return E.destroy=function(){A=!0},E.logger=c,E.track=f,E.dataloss=u,l.then(function(){A||(E.destroy=a.openChannel({service:"ot",name:"ot:".concat(e)},function(r){var t=r.channel,n=r.context;return E.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),E.replId=n.repl.id,E.dataloss&&E.shouldTrackDataLoss&&E.dataloss.ensureTrackedFile({replId:E.replId,filePath:e.toString()}),E.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,E.channel=t,t.onCommand(function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32){E.onError("missing data in ot packet",{originalError:null,op:null===(r=e.ot)||void 0===r?void 0:r.op,spookyVersion:null===(t=e.ot)||void 0===t?void 0:t.spookyVersion,crc32:null===(n=e.ot)||void 0===n?void 0:n.crc32});return}if(-1===E.version)return;var r,t,n,o,i={crc32:e.ot.crc32,op:(0,L.ug)(e.ot.op),version:e.ot.spookyVersion,userId:null!==(o=e.ot.userId)&&void 0!==o?o:0};return E.handlePacket(i,{overrideReconnectingBuffer:!1});case"otstatus":return E.handleStatus(e.otstatus);case"error":if(e.ref)return;return E.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return E.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return E.handleDeleteCursor(e.otDeleteCursor)}}),function(){E.channel=null,E.isReconnecting=!0,E.debounceSend.cancel(),E.debounceCommit.cancel(),E.timeDisconnected||(E.timeDisconnected=Date.now())}}))}),E}return t.prototype.commitToDisk=function(){var e=this;return(0,n._)(function(){var r,t,n,o,i,a;return(0,s.Jh)(this,function(l){switch(l.label){case 0:if(!e.channel)throw Error("Tryna commit while offline");if("open"!==e.channel.status)return[2];if(e.isReconnecting)throw Error("Committing while reconnecting");if(e.isClean())return[2];if(e.commitPromise)return e.debounceCommit(),[2];if(r=function(){},e.commitPromise=new Promise(function(e){return r=e}),!e.inflightOpsPromise)return[3,2];return[4,e.inflightOpsPromise];case 1:if(l.sent().channelClosed)return e.commitPromise=null,r(),[2];l.label=2;case 2:if(!(e.pending.length>0))return[3,4];if(e.debounceSend(),e.debounceSend.flush(),!e.inflightOpsPromise)return e.commitPromise=null,r(),e.onError("expected inflight promise",{originalError:null}),[2];return[4,e.inflightOpsPromise];case 3:if(l.sent().channelClosed)return e.commitPromise=null,r(),[2];l.label=4;case 4:return e.emit("commitStart"),t=e.version,n=e.serverContent,[4,e.channel.request({flush:{consistency:m.api.Flush.Consistency.Disk}})];case 5:if((o=l.sent()).channelClosed)return e.flushFailed=0,e.commitPromise=null,r(),[2];if("ok"!==o.body){if(e.commitPromise=null,r(),V(i=o.error||o.toString(),[U.Df.NotFound,U.Df.AlreadyExists,U.Df.NotDirectory,U.Df.IsDirectory,U.Df.DiskQuotaExceeded]))return e.onError("unable to flush",{originalError:i}),[2];return e.flushFailed++,setTimeout(function(){!e.isReconnecting&&e.channel&&"open"===e.channel.status&&e.debounceCommit()},Math.min(Math.random()*(Math.pow(2,e.flushFailed)-1)*1e3,1024e3)),[2]}return e.dataloss&&e.shouldTrackDataLoss&&(a=e.uncommittedOps[e.uncommittedOps.length-1])&&e.dataloss.storeOp({replId:e.replId,filePath:e.linkedFile.toString(),op:{crc32:a.crc32,version:a.version},opType:"latestFlushedOp",logger:e.logger,isReconnecting:e.isReconnecting}),e.uncommittedOps=[],e.hasUncommittedMultiplayerOps=!1,e.committedVersion=t,e.committedContent=n,e.flushFailed=0,e.emit("commitComplete",t),e.isClean()&&e.emit("fileClean"),e.commitPromise=null,r(),[2,o]}})})()},t}(O.EventEmitter),B=t(13112),z="SYNTHETIC_FILE_PATH.sql";function Q(e){var r,t,f=e.container,d=e.dataloss,p=e.track,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,r=[];return{enqueue:function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];if(r.length>=e)throw Error("fs: We retried too many things during a closed channel.");return new Promise(function(e){r.push(e)}).then(function(){return t.apply(void 0,(0,l._)(o))})},flush:function(){r.splice(0,r.length).forEach(function(e){return e()})}}}(),_=b.enqueue,F=b.flush,x=!1,T=null,O=null,R=null,P=0,I=new Map,N=new Map,M=new Map,J=[],L=new Map,A=new Set;f.openChannel({service:"fsevents"},function(e){var r=e.channel;T=r,r.onCommand(function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a=(0,E.S1)(i);if(j(),I.get(a)||t.type===m.api.File.Type.DIRECTORY)l=U.Tv.Directory;else{var l,s,u=Array.from(I.keys()).find(function(e){return(0,E.MO)(e,a)}),f=u&&(null===(s=I.get(u))||void 0===s?void 0:s.children.find(function(e){return e.filename===(0,E.Bf)(a)}));l=f?f.type:U.Tv.File}switch(o){case m.api.FileEvent.Op.Create:en({eventType:U.kS.Create,node:{path:a,type:l}});break;case m.api.FileEvent.Op.Modify:if(l===U.Tv.Directory){c.$e(function(e){e.setTag("service","fs"),e.setExtra("path-str",i),e.setExtra("op",o),e.setExtra("file-type",l),c.Tb(Error("Unexpected modify directory event"))});break}en({eventType:U.kS.Modify,node:{path:a,type:l}});break;case m.api.FileEvent.Op.Remove:en({eventType:U.kS.Delete,node:{path:a,type:l}});break;case m.api.FileEvent.Op.Move:if(null==n||null==n.path)throw Error("Expected dest path");var d=n.path;en({eventType:U.kS.Move,node:{path:a,type:l},to:(0,E.S1)(d)})}}}}});var t=(0,l._)(new Set((0,l._)(I.keys()).concat((0,l._)(N.keys()),(0,l._)(M.keys()))));return t.length&&r.send({subscribeFile:{files:t.map(function(e){return{path:e.toString()}})}}),function(){T=null}});var B=new Promise(function(e){return t=e});f.openChannel({service:function(e){return e.repl.authorizations.editFileContents.isAuthorized?"gcsfiles":"files"}},function(e){var r=e.channel;t(r),F();var n=(0,l._)(I.keys()).sort(),o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0)!function(){var e=s.value;es.readDir(e).then(function(r){var t=I.get(e);if(t){if(r.error){en({eventType:U.kS.Delete,node:{path:e,type:U.Tv.Directory}});return}var n=r.children,o=t.children,i=o.filter(function(e){return!n.some(function(r){return r.filename===e.filename&&r.type===e.type})}),a=!0,l=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var f=c.value;en({eventType:U.kS.Delete,node:{path:(0,E.K1)(e,f.filename),type:f.type}})}}catch(e){l=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(l)throw s}}var d=n.filter(function(e){return!o.some(function(r){return r.filename===e.filename&&r.type===e.type})}),h=!0,p=!1,v=void 0;try{for(var y,m=d[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var g=y.value;en({eventType:U.kS.Create,node:{path:(0,E.K1)(e,g.filename),type:g.type}})}}catch(e){p=!0,v=e}finally{try{h||null==m.return||m.return()}finally{if(p)throw v}}}})}()}catch(e){i=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}var u=!0,f=!1,d=void 0;try{for(var h,p=M.keys()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)!function(){var e=h.value;es.readFile(e,{fromDisk:!0}).then(function(r){var t=M.get(e);if(t){if(r.error){en({eventType:U.kS.Delete,node:{path:e,type:U.Tv.File}});return}r.content.toBuffer().equals(t.latestContent.toBuffer())||en({eventType:U.kS.Modify,node:{path:e,type:U.Tv.File}})}})}()}catch(e){f=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}return function(){B=new Promise(function(e){return t=e})}});var Q=(0,C.Z)();Q.promise.catch(function(e){return e});var Z=(0,g.Z)((0,n._)(function(){var e;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,Q.promise];case 1:return[4,r.sent().request({fsSnapshot:{}})];case 2:if((e=r.sent()).channelClosed)return[2,{success:!1,error:"channel closed"}];if(e.error)return[2,{success:!1,error:e.error}];return[2,{error:null,success:!0}]}})}),{wait:5e3,maxWait:1e4});f.openChannel({service:"snapshot",skip:function(e){return!e.repl.authorizations.editFileContents.isAuthorized}},function(e){var r=e.channel;return Q.resolve(r),function(){Q.isFulfilled&&(Q=(0,C.Z)()).promise.catch(function(e){return e})}});var K=U.kO.Clean,W=[],H=0;function j(){return $.apply(this,arguments)}function $(){return($=(0,n._)(function(){var e;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return H++,Y(),[4,es.persist()];case 1:return(e=r.sent()).error&&u.kg.error("Failed to persist, something very bad has probably happened",{originalError:e.error}),H--,Y(),[2]}})})).apply(this,arguments)}function Y(){return G.apply(this,arguments)}function G(){return(G=(0,n._)(function(){var e;return(0,s.Jh)(this,function(r){return(e=0===H&&0===X.length&&Array.from(N.values()).every(function(e){return e.otClient.isClean()}))===(K===U.kO.Clean)||(K=e?U.kO.Clean:U.kO.Syncing,W.forEach(function(e){e(K,{hasUserChanged:x})})),[2]})})).apply(this,arguments)}var X=[];function ee(e){x=!0,X.push(e),Y(),e.then(function(){var r=X.indexOf(e);r>-1&&X.splice(r,1),j()})}function er(e,r){return et.apply(this,arguments)}function et(){return(et=(0,n._)(function(e,r){var t,o;return(0,s.Jh)(this,function(i){var a;return a=(0,n._)(function(){var r,n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,B];case 1:if("open"!==(r=i.sent()).status)return[2,_(t)];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,r.request(e)];case 3:return n=i.sent(),[3,5];case 4:return o=i.sent(),c.Tb(Error("Send request failed with error: ".concat(o))),[2,_(t)];case 5:if(n.channelClosed)return[2,_(t)];return[2,n]}})}),o=(t=function(){return a.apply(this,arguments)})(),r.isMutative&&ee(o),[2,o]})})).apply(this,arguments)}function en(e){R=null;var r=(0,E.DH)(e.node.path),t=I.get(r),n=(0,E.Bf)(e.node.path);if(!n)throw Error("Expected filename");var a=null;if(e.eventType===U.kS.Move){var s=(0,E.DH)(e.to);a=I.get(s)}if(t||a)switch(e.eventType){case U.kS.Create:if(!t)break;var u=(0,l._)(t.children.filter(function(e){return e.filename!==n})).concat([{type:e.node.type,filename:n}]),f=!0,d=!1,h=void 0;try{for(var p,v=t.listeners[Symbol.iterator]();!(f=(p=v.next()).done);f=!0)(0,p.value.onChange)(u)}catch(e){d=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(d)throw h}}t.children=u;break;case U.kS.Move:var y=(0,E.Bf)(e.to);if(t&&t===a){var m=(0,l._)(t.children.filter(function(e){return e.filename!==n&&e.filename!==y})).concat([{type:e.node.type,filename:y}]),g=!0,C=!1,w=void 0;try{for(var D,b=t.listeners[Symbol.iterator]();!(g=(D=b.next()).done);g=!0)(0,D.value.onChange)(m)}catch(e){C=!0,w=e}finally{try{g||null==b.return||b.return()}finally{if(C)throw w}}t.children=m;break}if(t){var S=t.children.filter(function(e){return e.filename!==n}),k=!0,_=!1,F=void 0;try{for(var x,T=t.listeners[Symbol.iterator]();!(k=(x=T.next()).done);k=!0)(0,x.value.onChange)(S)}catch(e){_=!0,F=e}finally{try{k||null==T.return||T.return()}finally{if(_)throw F}}t.children=S}if(a){var O=(0,l._)(a.children.filter(function(e){return e.filename!==n&&e.filename!==y})).concat([{type:e.node.type,filename:y}]),P=!0,J=!1,L=void 0;try{for(var A,V=a.listeners[Symbol.iterator]();!(P=(A=V.next()).done);P=!0)(0,A.value.onChange)(O)}catch(e){J=!0,L=e}finally{try{P||null==V.return||V.return()}finally{if(J)throw L}}a.children=O}break;case U.kS.Delete:if(!t)break;var q=t.children.filter(function(e){return e.filename!==n}),B=!0,z=!1,Q=void 0;try{for(var Z,K=t.listeners[Symbol.iterator]();!(B=(Z=K.next()).done);B=!0)(0,Z.value.onChange)(q)}catch(e){z=!0,Q=e}finally{try{B||null==K.return||K.return()}finally{if(z)throw Q}}t.children=q;break;case U.kS.Modify:break;default:throw Error("unknown event")}switch(e.eventType){case U.kS.Move:case U.kS.Delete:var W=[N.get(e.node.path),M.get(e.node.path),I.get(e.node.path)],H=!0,j=!1,$=void 0;try{for(var Y,G=W[Symbol.iterator]();!(H=(Y=G.next()).done);H=!0){var X=Y.value;if(X){var ee=!0,er=!1,et=void 0;try{for(var eo,ei=X.listeners[Symbol.iterator]();!(ee=(eo=ei.next()).done);ee=!0){var ea=eo.value,el=ea.onMoveOrDelete,ec=ea.dispose;el&&el(e),ec()}}catch(e){er=!0,et=e}finally{try{ee||null==ei.return||ei.return()}finally{if(er)throw et}}}}}catch(e){j=!0,$=e}finally{try{H||null==G.return||G.return()}finally{if(j)throw $}}if(e.node.type===U.Tv.File)break;var eu=(0,l._)(new Set((0,l._)(I.keys()).concat((0,l._)(M.keys()),(0,l._)(N.keys())))).map(function(e){var r=N.get(e)||M.get(e)||I.get(e);if(!r)throw Error("expected node");return r}),ef=[],ed=!0,eh=!1,ep=void 0;try{for(var ev,ey=eu.sort()[Symbol.iterator]();!(ed=(ev=ey.next()).done);ed=!0){var em=ev.value;if((0,E.X2)(e.node.path,em.path)){var eg=ef.slice(-1)[0];if(!(eg&&(0,E.X2)(eg,em.path))){var eC={eventType:U.kS.Delete,node:{path:em.path,type:em.type}};e.eventType===U.kS.Move&&(eC=(0,i._)((0,o._)({},eC),{eventType:U.kS.Move,to:(0,E.eB)(e.node.path,e.to,em.path)})),ef.push(em.path),en(eC)}}}}catch(e){eh=!0,ep=e}finally{try{ed||null==ey.return||ey.return()}finally{if(eh)throw ep}}break;case U.kS.Create:case U.kS.Modify:if(!M.has(e.node.path))break;es.readFile(e.node.path,{fromDisk:!0}).then(function(r){var t=M.get(e.node.path);if(t){if(r.error){en({eventType:U.kS.Delete,node:{path:e.node.path,type:U.Tv.File}});return}t.latestContent=r.content;var n=!0,o=!1,i=void 0;try{for(var a,l=t.listeners[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var s=a.value.onChange;s&&s(r.content)}}catch(e){o=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}}}).catch(function(e){e.message="File read after modify error: "+e.message,c.Tb(e)})}}function eo(e){var r=!0,t=!1,n=void 0;try{for(var o,i=J[Symbol.iterator]();!(r=(o=i.next()).done);r=!0)(0,o.value)(e)}catch(e){t=!0,n=e}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}}function ei(){return(ei=(0,n._)(function(){var e,r,t,n,o,i,a;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(!(null===(t=f.getContext())||void 0===t?void 0:null===(r=t.repl)||void 0===r?void 0:r.language))throw Error("Expected repl language");return[4,(e=f).execImmediately.apply(e,["rg","--hidden","--files"].concat((0,l._)(S.hD.flatMap(function(e){return["--glob","!".concat(e)]}))))];case 1:if(o=(n=s.sent()).output,i=n.error,a=function(e){return!(!e||(0,S.Ci)(e))},!i&&o)return[2,R={error:null,files:o.split("\n").filter(a)}];if("exit status 1"===i)return[2,R={error:null,files:[]}];return c.Tb(Error("Find file command failed with error: ".concat(i))),[2,{error:i,files:null}]}})})).apply(this,arguments)}var ea=(r=(0,n._)(function(e,r,t){var o,i,a,l,c,u,f,d,p,v,y,m,g=arguments;function C(e){return w.apply(this,arguments)}function w(){return(w=(0,n._)(function(e){var r;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,o.request(e)];case 1:if((r=t.sent()).channelClosed)throw Error("channelClosed");if(r.error)throw Error(r.error);return[2,r]}})})).apply(this,arguments)}return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!(g.length>3&&void 0!==g[3]&&g[3])&&e===k.wL)return[2,{error:U.Df.InvalidPath}];return[4,B];case 1:o=n.sent(),i={eventType:U.kS.Create,node:{path:e,type:U.Tv.File}},n.label=2;case 2:return n.trys.push([2,12,,13]),a=r.size,[4,C({transferStart:{path:e.toString(),size:a}})];case 3:if(!(l=n.sent().transfer))throw Error("Failed to start a transfer (no transfer id)");c=524288,t(a,0),u=0,f=0,d=void 0,p=void 0,n.label=4;case 4:if(!(u<a))return[3,10];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,(d=r.slice(u,u+c)).arrayBuffer()];case 6:return p=n.sent(),[3,8];case 7:throw n.sent(),new U.SF;case 8:return v=new Uint8Array(p),[4,C({transferChunk:{id:l.id,content:v}})];case 9:return n.sent(),f=h.buf(v,f),u+=d.size,t(a,u),[3,4];case 10:return[4,C({transferComplete:{id:l.id,crc32:f}})];case 11:return n.sent(),[3,13];case 12:if("channelClosed"===(y=n.sent()).message)return[2,_(es.transferFile,e,r,t)];if((m=V(y.message,[U.Df.NotDirectory,U.Df.AlreadyExists,U.Df.DiskQuotaExceeded,U.Df.NotReadable]))===U.Df.DiskQuotaExceeded&&eo(i),m===U.Df.AlreadyExists&&(m=U.Df.IsDirectory),m)return[2,{error:m}];throw y;case 13:return en(i),[2,{error:null}]}})}),function(e,t,n){return r.apply(this,arguments)});function el(e){var r=new q(e,f,Promise.all((0,l._)(X).map(function(e){return e.catch(function(){})})).then(function(){}),f.logger,d,p);return r.on("commitComplete",j),r.on("fileDirty",Y),r.on("fileClean",Y),r.on("commitStart",Y),r}var es={getStatus:function(){return K},onStatusChange:function(e){return W.push(e),function(){var r=W.indexOf(e);r>-1&&W.splice(r,1)}},watchDir:function(e,r){var t=!1,n=function(){t=!0;var r=I.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==n}),0===r.listeners.length&&I.delete(e))};return es.readDir(e).then(function(a){if(!t){if(a.error){var l=Error(a.error);l.code=a.error,r.onError(l),n();return}var s=I.get(e);!s&&(s={path:e,type:U.Tv.Directory,children:a.children,listeners:[]},I.set(e,s),T&&T.send({subscribeFile:{files:[{path:e.toString()}]}})),s.listeners.push((0,i._)((0,o._)({},r),{dispose:n})),r.onChange(a.children)}}).catch(function(e){n(),r.onError(e)}),n},watchPathStat:function(e,r){var t=0,n=!1,o=function(i,l,s){if(l===U.Tv.File)return function(){};var c=(0,a._)(s),u=c[0],f=c.slice(1),d=u===e;if(d&&0!==f.length)throw Error("Invariant: child is target but has more children");var h=null,p=es.watchDir(i,{onChange:function(i){var a=i.find(function(e){return e.filename===(0,E.Bf)(u)});if(!a){n||(r.onNewStat({exists:!1}),n=!0),h&&(h.dispose(),h=null);return}if(h&&a.type!==h.node.type&&(h.dispose(),h=null),!h){if(d){var l=++t;es.stat(e).then(function(e){l===t&&e.exists&&(r.onNewStat(e),n=!1,h={node:a,dispose:function(){}})});return}h={node:a,dispose:o(u,a.type,f)}}},onError:r.onError});return function(){null==h||h.dispose(),p()}},i=(0,a._)((0,E.nV)(e)),l=i[0],s=i.slice(1);return o(l,U.Tv.Directory,s)},watchFilePath:function(e,r){var t,n=function(e,t){if(0===t.length){var o=es.watchFile((0,E.S1)(e),r);return function(){o()}}var i,a=t[0],l=!1,s=es.watchDir((0,E.S1)(e),{onChange:function(r){var o=r.find(function(e){return e.filename.toString()===a});if(!l&&o){i=n("".concat(e,"/").concat(a),t.slice(1)),l=!0;return}l=!1},onMoveOrDelete:function(){null==i||i()},onError:function(){}});return function(){null==i||i(),s()}},o=e.toString().split("/"),i=!1,a=es.watchDir((0,E.S1)(""),{onChange:function(e){var r=e.find(function(e){return e.filename.toString()===o[0]});if(!i&&r){t=n(o[0],o.slice(1)),i=!0;return}i=!1},onError:function(){}});return function(){null==t||t(),a()}},writeFile:function(e,r){return(0,n._)(function(){var t,n,o,i,a,l;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return n="string"==typeof r?w.Z.from(r).toBuffer():r.toBuffer(),[4,er({write:{path:e.toString(),content:n}},{isMutative:!0})];case 1:if(o=s.sent(),a=null===(t=I.get((0,E.DH)(e)))||void 0===t?void 0:t.children.some(function(r){return r.filename===(0,E.Bf)(e)}),i=M.has(e)||N.has(e)||a?{eventType:U.kS.Modify,node:{path:e,type:U.Tv.File}}:{eventType:U.kS.Create,node:{path:e,type:U.Tv.File}},o.error){if((l=V(o.error,[U.Df.NotDirectory,U.Df.AlreadyExists,U.Df.DiskQuotaExceeded]))===U.Df.DiskQuotaExceeded&&eo(i),l===U.Df.AlreadyExists&&(l=U.Df.IsDirectory),!l)throw Error(o.error);return[2,{error:l}]}return en(i),[2,{error:null}]}})})()},transferFile:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n._)(function(){var e;return(0,s.Jh)(this,function(t){return ee(e=ea.apply(void 0,(0,l._)(r))),[2,e]})})()},readFile:function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromDisk:!1}).fromDisk;return(0,n._)(function(){var t,n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:if(!r&&(t=N.get(e))&&t.otClient.getRawLocalContent()&&!t.otClient.isReconnecting)return[2,{content:w.Z.from(t.otClient.getRawLocalContent()),error:null}];return[4,er({read:{path:e.toString()}},{isMutative:!1})];case 1:if((n=i.sent()).error){if(!(o=V(n.error,[U.Df.NotFound,U.Df.IsDirectory])))throw Error(n.error);return[2,{error:o}]}if(!n.file||!n.file.path||!n.file.content)throw Error("Expected file");return[2,{content:w.Z.from(n.file.content),error:null}]}})})()},createDir:function(e){return(0,n._)(function(){var r,t,n;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return[4,er({mkdir:{path:e.toString()}},{isMutative:!0})];case 1:if(r=o.sent(),t={eventType:U.kS.Create,node:{path:e,type:U.Tv.Directory}},r.error){if((n=V(r.error,[U.Df.NotDirectory,U.Df.DiskQuotaExceeded]))===U.Df.DiskQuotaExceeded&&eo(t),!n)throw Error(r.error);return[2,{error:n}]}return en(t),[2,{error:null}]}})})()},moveDir:function(e,r){return(0,n._)(function(){var t,n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,er({move:{oldPath:e.toString(),newPath:r.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:U.kS.Move,node:{path:e,type:U.Tv.Directory},to:r},t.error){if((o=V(t.error,[U.Df.NotFound,U.Df.AlreadyExists,U.Df.NotDirectory,U.Df.DiskQuotaExceeded]))===U.Df.DiskQuotaExceeded&&eo(n),!o)throw Error(t.error);return[2,{error:o}]}return en(n),[2,{error:null}]}})})()},moveFile:function(e,r){return(0,n._)(function(){var t,n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,er({move:{oldPath:e.toString(),newPath:r.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:U.kS.Move,node:{path:e,type:U.Tv.File},to:r},t.error){if((o=V(t.error,[U.Df.NotFound,U.Df.AlreadyExists,U.Df.NotDirectory,U.Df.DiskQuotaExceeded]))===U.Df.DiskQuotaExceeded&&eo(n),!o)throw Error(t.error);return[2,{error:o}]}return en(n),[2,{error:null}]}})})()},copyFile:function(e,r){return(0,n._)(function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,es.readFile(e)];case 1:if((t=n.sent()).error)return[2,t];return[2,es.writeFile(r,t.content)]}})})()},copyDirFromRemote:function(e,r,t){return(0,n._)(function(){var n,o,i,a,l,c,u,f,d,h,p,v,y;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,this.deleteDir(e)];case 1:return s.sent(),[4,t.readDir(e)];case 2:if((n=s.sent()).error)return[2,n];return[4,this.readDir(r)];case 3:if((o=s.sent()).error!==U.Df.NotFound)return[3,5];return[4,this.createDir(e)];case 4:return s.sent(),[3,6];case 5:if(o.error===U.Df.NotDirectory)return[2,o];s.label=6;case 6:i=!0,a=!1,l=void 0,s.label=7;case 7:s.trys.push([7,15,16,17]),c=n.children[Symbol.iterator](),s.label=8;case 8:if(i=(u=c.next()).done)return[3,14];if(f=u.value,d=(0,E.K1)(e,f.filename),f.type!==U.Tv.File)return[3,11];return[4,t.readFile(d)];case 9:if((h=s.sent()).error)return[2,h];return[4,this.writeFile((0,E.K1)(r,f.filename),h.content)];case 10:if((p=s.sent()).error)return[2,p];return[3,13];case 11:if(f.type!==U.Tv.Directory)return[3,13];return[4,this.copyDirFromRemote(d,(0,E.K1)(r,f.filename),t)];case 12:if((v=s.sent()).error)return[2,v];s.label=13;case 13:return i=!0,[3,8];case 14:return[3,17];case 15:return y=s.sent(),a=!0,l=y,[3,17];case 16:try{i||null==c.return||c.return()}finally{if(a)throw l}return[7];case 17:return[2,{error:null}]}})}).apply(this)},copyFileFromRemote:function(e,r,t){return(0,n._)(function(){var n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,t.readFile(e)];case 1:if((n=i.sent()).error)return[2,n];return[4,this.writeFile(r,n.content)];case 2:if((o=i.sent()).error)return[2,o];return[2,{error:null}]}})}).apply(this)},deleteFile:function(e){return(0,n._)(function(){var r,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,er({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=V(r.error,[U.Df.NotFound])))throw Error(r.error);return[2,{error:t}]}return en({eventType:U.kS.Delete,node:{path:e,type:U.Tv.File}}),[2,{error:null}]}})})()},deleteDir:function(e){return(0,n._)(function(){var r,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,er({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=V(r.error,[U.Df.NotFound])))throw Error(r.error);return[2,{error:t}]}return en({eventType:U.kS.Delete,node:{path:e,type:U.Tv.Directory}}),[2,{error:null}]}})})()},readDir:function(e){return(0,n._)(function(){var r,t,n;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return[4,er({readdir:{path:e.toString()}},{isMutative:!1})];case 1:if((t=o.sent()).error){if(!(n=V(t.error,[U.Df.NotFound,U.Df.NotDirectory,U.Df.FileSystemUnavailable])))throw Error(t.error);return[2,{error:n}]}if(!(null===(r=t.files)||void 0===r?void 0:r.files))throw Error("Expected filesChannel");return[2,{children:t.files.files.map(function(e){if(!e.path)throw Error("Expected path");return{filename:(0,E.Bf)((0,E.S1)(e.path)),type:e.type===m.api.File.Type.DIRECTORY?U.Tv.Directory:U.Tv.File}}),error:null}]}})})()},stat:function(e){return(0,n._)(function(){var r;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,er({stat:{path:e.toString()}},{isMutative:!1})];case 1:if((r=t.sent()).error)throw Error(r.error);if(!r.statRes)throw Error("expected stat result");if(!r.statRes.exists)return[2,{exists:!1}];if(r.statRes.type===m.api.File.Type.DIRECTORY)return[2,{exists:!0,type:U.Tv.Directory,lastModified:new Date(1e3*r.statRes.modTime)}];return[2,{exists:!0,type:U.Tv.File,lastModified:new Date(1e3*r.statRes.modTime),byteLength:Number(r.statRes.size)}]}})})()},watchTextFile:function(e,r){var t=this;if(!(0,E.O5)(e)&&(0,E.C_)((0,E.S1)(e)))throw Error("Cannot watch root directory");var a=N.get(e);if(a||(a={path:e,type:U.Tv.File,listeners:[],otClient:el(e)},N.set(e,a)),!a)throw Error("Expected watchedOtFile");var c=!1,u=!1,f=function(){},d=[],h=function(o){if(f(),!a)throw Error("Expected watchedOtFile");var i,m,g,C,w,E=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};a.otClient.on("commitComplete",E);var D=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,U.KF.Dirty)};a.otClient.on("fileDirty",D);var b=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,U.KF.Clean)};a.otClient.on("fileClean",b);var S=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,U.KF.Syncing)};a.otClient.on("commitStart",S);var k=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};a.otClient.on("cursor",k);var _=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};a.otClient.on("removeCursor",_);var F=function(e){var t;return null===(t=r.onFileSavedChanged)||void 0===t?void 0:t.call(r,e)};a.otClient.on("fileSavedChanged",F);var T=(i=(0,n._)(function(r){var n,o,i,l,c,u,f,h,p,v,m,g;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(!a)throw Error("Expected watchedOtFile");return(n=a.otClient).destroy(),o=el(e),[4,new Promise(function(e,r){o.once("changes",function(){return e()}),o.once("error",function(e){return r(e)})})];case 1:if(s.sent(),i=n.getLocalContent(),l=o.getLocalContent(),c="local"===r?(0,y.F)(l,i):null,u="remote"===r?(0,y.F)(i,l):null,!a)throw Error("Expected watchedOtFile");a.otClient=o,f=!0,h=!1,p=void 0;try{for(v=a.listeners[Symbol.iterator]();!(f=(m=v.next()).done);f=!0)(0,m.value.reregister)(u)}catch(e){h=!0,p=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw p}}for(c&&o.writeChanges(c);d.length>0;)null===(g=d.pop())||void 0===g||g({isDisposed:!1});return[4,t.flush()];case 2:return s.sent(),[2]}})}),function(e){return i.apply(this,arguments)}),O=function(e){var t;return null===(t=r.onReconnectFail)||void 0===t?void 0:t.call(r,T,e)};a.otClient.on("promptUserReconnect",O),a.listeners[0].reregister===h&&a.otClient.on("promptUserReconnect",function(){if(N.has(e)){if(!a)throw Error("Expected watchedOtFile");a.listeners.some(function(e){return e.onReconnectFail})||T("remote")}});var R=function(e,t){r.onError&&r.onError(e,t),p()};a.otClient.on("error",R);var P=function(t,n){if(t===U.Df.DiskQuotaExceeded&&eo({eventType:U.kS.Modify,node:{path:e,type:U.Tv.File}}),r.onError){var o=Error(n);o.code=t,r.onError(o)}p()};a.otClient.on("fsError",P);var I=function(e,t){if(!a)throw Error("Expected watchedOtFile");x=!0;var n=v.as.of(e,a.otClient.getLocalContent().length,"\n");a.otClient.writeChanges(n,t);var o=!0,i=!1,l=void 0;try{for(var s,c=a.listeners[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value.onChange;u&&u!==r.onChange&&u({changes:n,changeSource:U.Fl.Local,version:a.otClient.version,latestContent:a.otClient.getLocalContent()})}}catch(e){i=!0,l=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw l}}},M=(m=(0,n._)(function(){return(0,s.Jh)(this,function(e){return(null==a?void 0:a.otClient.isReconnecting)?[2,new Promise(function(e,r){if(!a){r(Error("Expected watchedOtFile"));return}d.push(e)})]:[2,{isDisposed:c}]})}),function(){return m.apply(this,arguments)}),J=function(){for(;d.length>0;){var e;null===(e=d.pop())||void 0===e||e({isDisposed:!1})}};a.otClient.on("transparentReconnect",J);var L=(g=(0,n._)(function(){var e,r,t,n,o,i=arguments;return(0,s.Jh)(this,function(s){switch(s.label){case 0:for(r=Array(e=i.length),t=0;t<e;t++)r[t]=i[t];if(!a)throw Error("Expected watchedOtFile");s.label=1;case 1:return s.trys.push([1,3,,4]),[4,M()];case 2:if(s.sent().isDisposed)return[2,{isDisposed:!0,result:null}];return[3,4];case 3:if(o=s.sent(),c)return[2,{isDisposed:!0,result:null}];throw o;case 4:return[4,(n=a.otClient).fetchChanges.apply(n,(0,l._)(r))];case 5:return[2,{isDisposed:!1,result:s.sent()}]}})}),function(){return g.apply(this,arguments)}),A=(C=(0,n._)(function(){var e,r,t,n,o=arguments;return(0,s.Jh)(this,function(i){switch(i.label){case 0:for(r=Array(e=o.length),t=0;t<e;t++)r[t]=o[t];if(!a)throw Error("Expected watchedOtFile");return[4,M()];case 1:if(i.sent().isDisposed)throw Error("File was disposed");return[2,(n=a.otClient).transformSelection.apply(n,(0,l._)(r))]}})}),function(){return C.apply(this,arguments)}),V=function(e){if(!a)throw Error("Expected watchedOtFile");a.otClient.updateCursors(e)};-1!==a.otClient.version&&setTimeout(function(){var e;if(!u){if(!a)throw Error("Expected watchedOtFile");u=!0,null===(e=r.onReady)||void 0===e||e.call(r,{initialContent:a.otClient.getLocalContent(),writeChange:I,updateSelections:V,fetchChanges:L,transformSelection:A,version:a.otClient.version})}}),o&&(null===(w=r.onChange)||void 0===w||w.call(r,{changes:o,changeSource:U.Fl.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent(),userId:0}));var q=function(e,t){var n,o;if(!a)throw Error("Expected watchedOtFile");if(!u){u=!0,null===(o=r.onReady)||void 0===o||o.call(r,{initialContent:a.otClient.getLocalContent(),writeChange:I,updateSelections:V,fetchChanges:L,transformSelection:A,version:a.otClient.version});return}null===(n=r.onChange)||void 0===n||n.call(r,{changes:e,changeSource:U.Fl.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent(),userId:t})};a.otClient.on("changes",q),f=function(){if(!a)throw Error("Expected watchedOtFile");a.otClient.removeListener("commitComplete",E),a.otClient.removeListener("fileDirty",D),a.otClient.removeListener("fileClean",b),a.otClient.removeListener("commitStart",S),a.otClient.removeListener("error",R),a.otClient.removeListener("fsError",P),a.otClient.removeListener("changes",q),a.otClient.removeListener("cursor",k),a.otClient.removeListener("removeCursor",_),a.otClient.removeListener("promptUserReconnect",O),a.otClient.removeListener("transparentReconnect",J),a.otClient.removeListener("fileSavedChanged",F)},Y()},p=function(){for(;d.length>0;){var r;null===(r=d.pop())||void 0===r||r({isDisposed:!0})}if(!c&&N.has(e)){if(c=!0,u=!0,f(),!a)throw Error("Expected watchedOtFile");a.listeners=a.listeners.filter(function(e){return e.dispose!==p}),0===a.listeners.length&&(a.otClient.destroy(),N.delete(e))}};return a.listeners.push((0,i._)((0,o._)({},r),{dispose:p,reregister:h})),h(null),p},watchFile:function(e,r){if(!(0,E.O5)(e)&&(0,E.C_)((0,E.S1)(e)))throw Error("Cannot watch root directory");var t=!1,n=function(){t=!0;var r=M.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==n}),0===r.listeners.length&&M.delete(e))};return es.readFile(e).then(function(a){if(!t){if(a.error){var l=Error(a.error);l.code=a.error,r.onError&&r.onError(l),n();return}var s=M.get(e);if(!s&&(s={path:e,type:U.Tv.File,listeners:[],latestContent:a.content},M.set(e,s),T&&T.send({subscribeFile:{files:[{path:e.toString()}]}})),!s)throw Error("Expected watched file");s.listeners.push((0,i._)((0,o._)({},r),{dispose:n})),r.onChange(a.content)}}),n},listFiles:function(){return(0,n._)(function(){var e;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(R&&f.performance.now()-P<1e4)return[2,R];return O||(O=function(){return ei.apply(this,arguments)}(),P=f.performance.now()),[4,O];case 1:return e=r.sent(),O=null,[2,e]}})})()},flush:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.WL.UNKNOWN;return(0,n._)(function(){var t,o,i,a,l,c,u,f,d,h,p,v,y,m,g,C,w,E,D,b,S,k,_,F,x,T,O,R,P,I,M,J,U,V,q,B,z,Q,Z,K,W,H,j,$;return(0,s.Jh)(this,function(Y){switch(Y.label){case 0:var G;if(G=(0,n._)(function(e){var t,n,o,i,a,l,c,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(t=e.path,!(n=L.get(t)))return[2];o=!0,i=!1,a=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),l=n[Symbol.iterator](),s.label=2;case 2:if(o=(c=l.next()).done)return[3,5];return[4,(0,c.value)(e.otClient.getLocalContent(),r)];case 3:s.sent(),s.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return u=s.sent(),i=!0,a=u,[3,8];case 7:try{o||null==l.return||l.return()}finally{if(i)throw a}return[7];case 8:return[2]}})}),t=function(e){return G.apply(this,arguments)},o=function(e){var t=e.path,n=!0,o=!1,i=void 0;try{for(var a,l=A[Symbol.iterator]();!(n=(a=l.next()).done);n=!0)(0,a.value)(t,r)}catch(e){o=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}},i=[],a=function(e){null===e.otClient.channel||e.otClient.isReconnecting||i.push(e.otClient.flush())},void 0!==e)return[3,9];l=!0,c=!1,u=void 0,Y.label=1;case 1:Y.trys.push([1,6,7,8]),f=N.values()[Symbol.iterator](),Y.label=2;case 2:if(l=(d=f.next()).done)return[3,5];return h=d.value,[4,t(h)];case 3:Y.sent(),Y.label=4;case 4:return l=!0,[3,2];case 5:return[3,8];case 6:return p=Y.sent(),c=!0,u=p,[3,8];case 7:try{l||null==f.return||f.return()}finally{if(c)throw u}return[7];case 8:v=!0,y=!1,m=void 0;try{for(g=N.values()[Symbol.iterator]();!(v=(C=g.next()).done);v=!0)w=C.value,a(w)}catch(e){y=!0,m=e}finally{try{v||null==g.return||g.return()}finally{if(y)throw m}}return[3,18];case 9:E=!0,D=!1,b=void 0,Y.label=10;case 10:Y.trys.push([10,15,16,17]),S=e[Symbol.iterator](),Y.label=11;case 11:if(E=(k=S.next()).done)return[3,14];if(_=k.value,!(void 0!==(F=N.get(_))))return[3,13];return[4,t(F)];case 12:Y.sent(),Y.label=13;case 13:return E=!0,[3,11];case 14:return[3,17];case 15:return p=Y.sent(),D=!0,b=p,[3,17];case 16:try{E||null==S.return||S.return()}finally{if(D)throw b}return[7];case 17:x=!0,T=!1,O=void 0;try{for(R=e[Symbol.iterator]();!(x=(P=R.next()).done);x=!0)I=P.value,M=N.get(I),void 0!==M&&a(M)}catch(e){T=!0,O=e}finally{try{x||null==R.return||R.return()}finally{if(T)throw O}}Y.label=18;case 18:return Y.trys.push([18,20,,21]),[4,Promise.all(i.concat(X))];case 19:if(Y.sent(),void 0===e){J=!0,U=!1,V=void 0;try{for(q=N.values()[Symbol.iterator]();!(J=(B=q.next()).done);J=!0)z=B.value,o(z)}catch(e){U=!0,V=e}finally{try{J||null==q.return||q.return()}finally{if(U)throw V}}}else{Q=!0,Z=!1,K=void 0;try{for(W=e[Symbol.iterator]();!(Q=(H=W.next()).done);Q=!0)j=H.value,$=N.get(j),void 0!==$&&o($)}catch(e){Z=!0,K=e}finally{try{Q||null==W.return||W.return()}finally{if(Z)throw K}}}return[3,21];case 20:return Y.sent(),[3,21];case 21:return[2]}})})()},registerOnBeforeFlush:function(e,r){var t,n=null!==(t=L.get(e))&&void 0!==t?t:new Set;return n.add(r),L.set(e,n),function(){var t;return null===(t=L.get(e))||void 0===t?void 0:t.delete(r)}},registerOnFlushSuccess:function(e){return A.add(e),function(){A.delete(e)}},persist:function(e){var r=Z();return e&&e.skipDebounce&&Z.flush(),r},getOTVersion:function(e){if(e===z)return 123;var r=N.get(e);if(!r)throw Error("No file with path ".concat(e," found."));return r.otClient.version},isFileOrDirSaved:function(e){if((0,D.Mb)(e)){var r=N.get(e);return!r||r.otClient.isFileSaved()}return!0},onDiskQuotaExceeded:function(e){return J.push(e),function(){J=J.filter(function(r){return r!==e})}}};return es}var Z=f.Dy.Object({cluster:f.Dy.String(),sourceRepl:f.Dy.String(),zipperToken:f.Dy.String(),expirySeconds:f.Dy.Number()});function K(e){var r,t=e.replId,i=e.getCaptcha;function a(){return(a=(0,n._)(function(){var e,r,n,o,a,l,c,u,f,h,v;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[3,1];case 1:return[4,i()];case 2:return r=(e=s.sent()).isEmbed,n=e.hCaptchaSiteKey,o=e.recaptchaToken,a={captcha:e.captcha,isEmbed:r,hCaptchaSiteKey:n,recaptchaToken:o,asViewer:!0},[4,fetch("/data/repls/".concat(t,"/get_zipper_token"),{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify(a)})];case 3:if(!(l=s.sent()).ok)throw Error("Failed to get zipper token: ".concat(l.status," ").concat(l.statusText));return[4,l.json()];case 4:if(c=s.sent(),!d.B4.Check(Z,c))throw(0,B.ZA)(Z,c);return u=c.cluster,f=c.sourceRepl,h=c.zipperToken,v=c.expirySeconds,[2,{sourceReplId:f,baseUrl:(0,b.P2)(u),token:h,exp:(0,p.Z)(new Date,v-10)}];case 5:return[2]}})})).apply(this,arguments)}function l(){return c.apply(this,arguments)}function c(){return(c=(0,n._)(function(){var e;return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(e=!r)return[3,2];return[4,r];case 1:e=t.sent().exp.getTime()<=new Date().getTime(),t.label=2;case 2:return e&&(r=function(){return a.apply(this,arguments)}()),[4,r];case 3:return[2,t.sent()]}})})).apply(this,arguments)}var u={watchDir:function(e,r){return u.readDir(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.children)}),function(){}},watchFile:function(e,r){return u.readFile(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.content)}),function(){}},stat:function(e){return(0,n._)(function(){var r;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,u.readFile(e)];case 1:if((r=t.sent()).error)switch(r.error){case U.Df.NotFound:return[2,{exists:!1}];case U.Df.IsDirectory:return[2,{exists:!0,type:U.Tv.Directory,lastModified:new Date}]}return[2,{exists:!0,type:U.Tv.File,byteLength:r.content.length,lastModified:new Date}]}})})()},readDir:function(e){return(0,n._)(function(){var r,t,n,i,a,c,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,l()];case 1:return t=(r=s.sent()).sourceReplId,n=r.baseUrl,i=r.token,[4,fetch("".concat(n,"/repls/").concat(t,"/files/dir?path=").concat(e),(0,o._)({},i&&{headers:{Authorization:"Bearer ".concat(i)}}))];case 2:if(!(a=s.sent()).ok)return[3,4];return[4,a.json()];case 3:return[2,{children:null!==(c=s.sent())&&void 0!==c?c:[],error:null}];case 4:return[4,a.text()];case 5:if(u=s.sent(),404===a.status&&"file not found"===u)return[2,{error:U.Df.NotFound}];if(400===a.status&&"file is not a directory"===u)return[2,{error:U.Df.NotDirectory}];throw Error("Error when trying to read dir through zipper, status: ".concat(a.status,", body: ").concat(u));case 6:return[2]}})})()},readFile:function(e,r){return(0,n._)(function(){var r,t,n,i,a,c,u,f;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,l()];case 1:return t=(r=s.sent()).sourceReplId,n=r.baseUrl,i=r.token,[4,fetch("".concat(n,"/repls/").concat(t,"/files/file?path=").concat(e),(0,o._)({},i&&{headers:{Authorization:"Bearer ".concat(i)}}))];case 2:if(!(a=s.sent()).ok)return[3,4];return c={},u=w.Z.bind,[4,a.arrayBuffer()];case 3:return[2,(c.content=new(u.apply(w.Z,[void 0,s.sent()])),c.error=null,c)];case 4:return[4,a.text()];case 5:if(f=s.sent(),404===a.status&&"file not found"===f)return[2,{error:U.Df.NotFound}];if(400===a.status&&"file is a directory"===f)return[2,{error:U.Df.IsDirectory}];throw Error("Error when trying to read file through zipper, status: ".concat(a.status,", body: ").concat(f));case 6:return[2]}})})()}};return u}},60245:function(e,r,t){t.d(r,{ed:function(){return a},f5:function(){return c},gR:function(){return o},mt:function(){return l},tT:function(){return u},ug:function(){return i}});var n=t(80403);function o(e){return e.map(function(e){return"object"==typeof e?{delete:e.d}:"number"==typeof e?{skip:e}:{insert:e}})}function i(e){return e.map(function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"==typeof e.insert)return e.insert;throw Error("Unexpected op type")})}function a(e,r){var t=[],n=r,o=0,i=0,a=0,l=0,s=function(e){var t=e-i;if(e<i)throw Error("expected changeset to be ordered");for(var n=i+a;n<i+t+a;n++){var o=r.charCodeAt(n);o>=55296&&o<=57343?(l++,n++):13===o&&10===r.charCodeAt(n+1)&&(a++,n++)}i+=t};return e.iterChanges(function(e,r,c,u,f){if(e>0){var d=i+a,h=d-l;s(e);var p=i+a,v=p-l;t.push(v-h),o+=p-d}if(e!==r){var y=i+a,m=y-l;s(r);var g=i+a,C=g-l;t.push({d:C-m}),n=n.slice(0,o)+n.slice(o+(g-y))}if(f.length){var w=f.sliceString(0);t.push(w),n=n.slice(0,o)+w+n.slice(o),o+=w.length}}),{op:t,docAfter:n}}function l(e,r){var t=[],o=r,i=0,a=0,l=0,s=0,c=function(e){for(var t=a+l;t<a+e+l;t++){var n=r.charCodeAt(t);n>=55296&&n<=57343?(l++,t++):13===n&&10===r.charCodeAt(t+1)&&(s++,t++)}a+=e},f=!0,d=!1,h=void 0;try{for(var p,v,y=e[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var m=v.value;if("string"==typeof m){var g=m;o=o.slice(0,i)+g+o.slice(i),i+=g.length;var C=a+l;if(g.endsWith("\r")&&"\n"===r.slice(C,C+1)&&(g=g.slice(0,-1),0===g.length))continue;var w=u(g),E=C-s;(null==p?void 0:p.to)===E?p.insert=p.insert?p.insert.append(w):w:(p={from:C-s,insert:w},t.push(p))}else if("number"==typeof m){var D=l;c(m);var b=l-D;i+=m+b}else if("d"in m){var S=a+l,k=s;c(m.d);var _=a+l,F=_-S;o=o.slice(0,i)+o.slice(i+F);var x=S-k,T=_-s;if("\r\n"===r.slice(S-1,S+1)&&(x+=1,(T-=1)-x<=0))continue;(null==p?void 0:p.to)===x?p.to=T:(p={from:x,to:T},t.push(p))}}}catch(e){d=!0,h=e}finally{try{f||null==y.return||y.return()}finally{if(d)throw h}}if(a+l!==r.length){var O=r.slice(a+l);s+=O.split("\r\n").length-1}return{changes:n.as.of(t,r.length-s),docAfter:o}}var s=/\r\n?|\n/;function c(e){return e.replaceAll("\r\n","\n").replaceAll("\r","\n")}function u(e){return n.xv.of(e.split(s))}}}]);
//# sourceMappingURL=6151-0b4f1a3b3de404b6.js.map